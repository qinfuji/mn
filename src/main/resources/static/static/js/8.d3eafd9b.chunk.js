(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{658:function(e,t,a){"use strict";a.r(t);a(634);var n=a(638),r=a(237),o=a(18),s=a.n(o),i=a(17),c=a(33),l=a(41),u=a(42),p=a(44),d=a(43),m=a(45),f=(a(628),a(629)),h=(a(631),a(632)),v=a(1),b=a.n(v),g=a(641),y=a(15),E=a.n(y),C=a(642),k=a(643),O=a(27),S="InfoWindow",P=console.log,x=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(p.a)(this,Object(d.a)(t).call(this))).refElement=null,e._entity=null,P(S,"constructor",e._entity),e}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){P(S,"componentDidMount",this._entity);var e=this.props,t=e.__map__,a=e.options,n=e.events,r=(e.children,Object(i.a)({},a||{},{map:t}));this._entity=Object(O.b)(r,n),this._entity&&this.props.refer&&this.props.refer(this._entity)}},{key:"componentDidUpdate",value:function(e){P(S,"componentDidUpdate",this._entity);var t=this.props,a=t.__map__,n=t.options,r=t.events,o=(t.children,Object(i.a)({},n||{},{map:a}));if(!this._entity)return this._entity=Object(O.b)(o,r),void(this._entity&&this.props.refer&&this.props.refer(this._entity));var s=Object(i.a)({},e.options||{},{map:e.__map__});Object(O.n)(this._entity,o,r,s,e.events)}},{key:"componentWillUnmount",value:function(){P(S,"componentWillUnmount",this._entity),this._entity&&(this._entity.setMap(null),this._entity=null,this.props.refer&&this.props.refer(this._entity))}},{key:"render",value:function(){return P(S,"render",this._entity),null}}]),t}(v.Component),w=a(134),T=a(644),A=a(40),I=a(104).a.HOST;function j(e){return _.apply(this,arguments)}function _(){return(_=Object(c.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(A.a)("".concat(I,"/api/estimateTask/querybyPointerAddressId?paId=").concat(t.pointerAddressId),{method:"GET"}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e,t){return M.apply(this,arguments)}function M(){return(M=Object(c.a)(s.a.mark(function e(t,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("save"!==a){e.next=4;break}return e.abrupt("return",Object(A.a)("".concat(I,"/api/estimateTask/create"),{method:"POST",body:t}));case 4:return e.abrupt("return",Object(A.a)("".concat(I,"/api/estimateTask/submit"),{method:"POST",body:t}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function U(e){return F.apply(this,arguments)}function F(){return(F=Object(c.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(A.a)("".concat(I,"/api/estimateTask/getDataResult?emtimateId=").concat(t.id),{method:"GET"}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e,t){return L.apply(this,arguments)}function L(){return(L=Object(c.a)(s.a.mark(function e(t,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(A.a)("".concat(I,"/api/estimateTask/saveConclusion?emtimateId=").concat(t),{method:"PUT",body:a}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var R,W,V,N=a(234),B={strokeWeight:3,strokeOpacity:.8,fillColor:"#ee2200",fillOpacity:.1,strokeStyle:"dashed"},Y={strokeWeight:1.8,strokeOpacity:.4,fillColor:"#ee2200",fillOpacity:.1,strokeStyle:"solid",bubble:!0},z={strokeColor:"blue",strokeWeight:1.8,strokeOpacity:.4,fillColor:"blue",fillOpacity:.1,strokeStyle:"solid",bubble:!0},K={strokeColor:"#3b97e3",strokeWeight:2,strokeOpacity:.4,fillColor:"#3b97e3",fillOpacity:.4,strokeStyle:"solid",bubble:!0},X={strokeColor:"#e27a17e6",strokeWeight:2,strokeOpacity:.8,fillColor:"#e27a17e6",fillOpacity:.4,strokeStyle:"solid",bubble:!0},q={strokeColor:"#F33",strokeOpacity:.4,strokeWeight:1.8,fillColor:"#ee2200",fillOpacity:.08,bubble:!0},Z=a(326),G={status:{STATUS_WAIT_COMMIT:0,STATUS_COMMITED:1},execState:{EXEC_STATUS_NULL:0,EXEC_STATUS_CALCULATED_FENCE:1,EXEC_STATUS_REQUESTED_FENCE_DATA:2,EXEC_STATUS_REQUESTED_FENCE_HOT_DATA:4,EXEC_STATUS_FINISH_CODE:7},dateReaultState:{RESULT_DATE_STATUS_WAIT_SUBMIT:"waitSubmit",RESULT_DATE_STATUS_SUBMITED:"submited"}},J=(a(640),a(637)),Q=(a(325),a(630)),$=(a(327),a(156)),ee=(a(646),a(12)),te=(a(328),a(109)),ae=(a(329),a(63)),ne=(a(170),a(52)),re=(a(649),a(651)),oe=(a(650),a(653)),se=(a(645),a(647)),ie=(a(655),a(652)),ce=(a(232),a(115)),le=a(635),ue=(f.a.Item,ce.a.Option),pe=ie.a.RangePicker,de=f.a.create()(R=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={treeData:[]},a.saveOrUpdate=function(){var e=Object(c.a)(s.a.mark(function e(t){var n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.props,r=n.form.validateFields,o=n.saveOrUpdate,r(function(){var e=Object(c.a)(s.a.mark(function e(a,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return");case 2:o&&o(n,t);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onSave=function(){a.saveOrUpdate("save")},a.onSubmit=function(){a.saveOrUpdate("submit")},a.onLabelsChange=function(e){var t=a.props.onLabelsChange;if(t){var n=a.props.form.getFieldsValue();n.filterLabels=e,t(e,n)}},a.onDistanceChange=function(e){var t=a.props.onDistanceChange;if(t){var n=a.props.form.getFieldsValue();n.distance=e,t(e,n)}},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(Object(c.a)(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(le.c)();case 2:a=t.sent,e.setState({treeData:a});case 4:case"end":return t.stop()}},t)})),100)}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.pointerAddress,r=t.appraise,o=t.onCompetitorIdsChange,s=t.competitors,i=t.userHotFencePolygons,c=t.goBackList,l=t.onCreateUserFenceHandle,u=[];if(r&&r.fencesHotDate){var p=r.fencesHotDate.split(";");u.push(E()(p[0])),u.push(E()(p[1]))}return b.a.createElement("div",{className:"pointerCreate"},b.a.createElement(J.a,{title:"\u8bc4\u4f30\u70b9\uff1a".concat(n.name),bordered:!1},b.a.createElement(f.a,null,b.a.createElement(f.a.Item,{label:"\u4e1a\u6001\u6807\u7b7e"},a("filterLabels",{initialValue:r&&r.filterLabels?r.filterLabels.split(","):[]})(b.a.createElement(se.a,{dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"\u8bf7\u9009\u62e9",allowClear:!0,multiple:!0,onChange:this.onLabelsChange,treeData:this.state.treeData}))),b.a.createElement(f.a.Item,{label:"\u7ade\u5bf9\u5448\u73b0"},a("competitorIds",{initialValue:r&&r.competitorIds?r.competitorIds.split(","):[]})(b.a.createElement(ce.a,{mode:"multiple",placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},onChange:o},s.map(function(e){return e.id!==n.id?b.a.createElement(ue,{key:e.id,value:e.id},e.name):null})))),b.a.createElement(f.a.Item,{label:"\u5230\u8bbf\u767e\u5206\u6bd4"},a("arriveScale",{initialValue:r&&r.arriveScale?parseInt(r.arriveScale)/10:.1})(b.a.createElement(oe.a,{step:.1,max:100,min:.1}))),b.a.createElement(f.a.Item,{label:"\u8f90\u5c04\u8ddd\u79bb"},a("distance",{initialValue:r&&r.distance?parseInt(r.distance):1e3})(b.a.createElement(oe.a,{marks:{1000:"1KM",1500:"1.5KM",2000:"2KM",2500:"2.5KM",3000:"3KM"},step:500,max:3e3,min:1e3,onChange:this.onDistanceChange}))),b.a.createElement(f.a.Item,{label:"\u5b58\u91cf\u4eba\u53e3"},a("showPersonCount",{initialValue:!(!r||null==r.showPersonCount||"undefined"==typeof r.showPersonCount)&&0!==r.showPersonCount,valuePropName:"checked"})(b.a.createElement(re.a,{size:"small",checkedChildren:"\u663e\u793a",unCheckedChildren:"\u4e0d\u663e\u793a"}))),b.a.createElement(f.a.Item,{label:"\u70ed\u529b\u5206\u6790"},b.a.createElement(J.a,{id:"hotCard"},b.a.createElement(te.a,null,b.a.createElement(ae.a,null,(!r||r&&r.state===G.status.STATUS_WAIT_COMMIT)&&b.a.createElement(ne.a,{type:"primary",size:"small",onClick:l},"\u65b0\u5efa\u56f4\u680f"))),b.a.createElement(te.a,null,b.a.createElement(ae.a,null,i&&i.map(function(t){return b.a.createElement(Q.a,{readOnly:!0,key:t.id,value:t.options.path.join(";"),suffix:(!r||r&&r.state===G.status.STATUS_WAIT_COMMIT)&&b.a.createElement($.a,{title:"\u5220\u9664\u56f4\u680f"},b.a.createElement(ee.a,{type:"delete",style:{color:"rgba(0,0,0,.45)"},onClick:function(){e.onRemoveUserHotFence(t)}}))})}))),b.a.createElement(te.a,{gutter:10},b.a.createElement(ae.a,{span:8},"\u9009\u62e9\u65e5\u671f:"),b.a.createElement(ae.a,{span:16},a("fencesHotDate",{initialValue:u})(b.a.createElement(pe,null)))),b.a.createElement(te.a,{gutter:10},b.a.createElement(ae.a,null,"\u56f4\u680f\u70ed\u529b\u6761\u4ef6"),b.a.createElement(ae.a,null,a("fenaceHotCondition",{initialValue:r&&r.fenaceHotCondition?r.fenaceHotCondition:""})(b.a.createElement(ce.a,null,b.a.createElement(ue,{value:"1"},"\u4eba\u53e3"))))))),b.a.createElement(f.a.Item,{label:"\u6d4b\u63a7\u70b9"},a("observeId",{initialValue:r&&r.observeId?r.observeId:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(b.a.createElement(ce.a,null,b.a.createElement(ue,{value:"1221212"},"\u6d4b\u63a7\u70b91"))))),b.a.createElement("div",{id:"btnbar",style:{marginTop:"20px"}},(!r||r&&r.state===G.status.STATUS_WAIT_COMMIT)&&b.a.createElement(ne.a,{size:"small",type:"primary",onClick:this.onSave},"\u4fdd\u5b58"),(!r||r&&r.state===G.status.STATUS_WAIT_COMMIT)&&b.a.createElement(ne.a,{size:"small",type:"primary",onClick:this.onSubmit},"\u4fdd\u5b58\u5e76\u63d0\u4ea4"),b.a.createElement(ne.a,{size:"small",type:"primary",onClick:c},"\u8fd4\u56de\u5217\u8868"))))}}]),t}(b.a.Component))||R,me=(a(639),a(636)),fe=ce.a.Option,he=f.a.create()(W=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onSave=function(){var e=a.props,t=e.form.validateFields,n=e.onSave;t(function(){var e=Object(c.a)(s.a.mark(function e(t,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:n&&n(a);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}())},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.pointerAddress,n=e.appraiseDataResult,r=e.goBackList;return b.a.createElement("div",{id:"conclusion"},b.a.createElement(J.a,{title:"\u70b9\u5740\u540d\u79f0:".concat(a.name),bordered:!1},b.a.createElement(te.a,null,b.a.createElement(ae.a,null,b.a.createElement(f.a,{layout:"horizontal"},b.a.createElement(f.a.Item,{label:"\u5230\u8bbf\u56f4\u680f\u4eba\u53e3\u6570\u91cf"},b.a.createElement(me.a,{bordered:!0,size:"small",columns:[{title:"\u7c7b\u578b",dataIndex:"type"},{title:"\u6570\u91cf"}]})),b.a.createElement(f.a.Item,null,b.a.createElement("div",null,"\u6d4b\u63a7\u5ba2\u6d41\u91cf:",n&&n.observerRateFlow?n.observerRateFlow:"0")),b.a.createElement(f.a.Item,{label:"\u70b9\u5740\u7ed3\u8bba"},t("conclusion",{initialValue:n&&n.conclusion?n.conclusion:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(b.a.createElement(ce.a,{placeholder:"\u8bf7\u9009\u62e9"},b.a.createElement(fe,{value:"1"},"\u653b\u575a"),b.a.createElement(fe,{value:"2"},"\u72ec\u5360"),b.a.createElement(fe,{value:"3"},"\u4e3b\u52a8\u5206\u6d41"),b.a.createElement(fe,{value:"4"},"\u88ab\u52a8\u5206\u6d41")))),b.a.createElement(f.a.Item,{label:"\u51c6\u5165\u65f6\u95f4"},t("enterDate",{initialValue:n&&n.enterDate?n.enterDate:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(b.a.createElement(ce.a,null,b.a.createElement(fe,{value:"2019"},"2019\u5e74"),b.a.createElement(fe,{value:"2020"},"2020\u5e74"),b.a.createElement(fe,{value:"2021"},"2021\u5e74"),b.a.createElement(fe,{value:"2022"},"2022\u5e74"),b.a.createElement(fe,{value:"2023"},"2023\u5e74"),b.a.createElement(fe,{value:"2024"},"2024\u5e74"),b.a.createElement(fe,{value:"2025"},"2025\u5e74"),b.a.createElement(fe,{value:"2026"},"2026\u5e74")))),b.a.createElement(f.a.Item,{label:"\u5546\u5708\u7c7b\u578b"},t("businessType",{initialValue:n&&n.businessType?n.businessType:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(b.a.createElement(ce.a,null,b.a.createElement(fe,{value:"1"},"\u7c7b\u578b\u4e00"),b.a.createElement(fe,{value:"2"},"\u7c7b\u578b\u4e8c")))),b.a.createElement(f.a.Item,null),b.a.createElement(f.a.Item,null,b.a.createElement("label",null,"\u8f90\u5c04\u9762\u79ef:",n&&n.radiationArea?parseFloat(n.radiationArea).toFixed(3)+"\u5e73\u65b9\u516c\u91cc":"0")))))),b.a.createElement("div",{id:"btnbar",style:{textAlign:"end"}},(!n||n.state!==G.dateReaultState.RESULT_DATE_STATUS_SUBMITED)&&b.a.createElement(ne.a,{type:"primary",onClick:this.onSave},"\u4fdd\u5b58"),b.a.createElement(ne.a,{type:"primary",onClick:r},"\u8fd4\u56de\u5217\u8868")))}}]),t}(b.a.Component))||W;var ve=h.a.Content,be=h.a.Sider;function ge(e){if(!e)return[];var t=e.split(";");if(t.length>=3){var a=[];return t.forEach(function(e){var t=e.split(",");2===t.length&&a.push(t)}),a}return[]}var ye=f.a.create()(V=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).setMapInstance=function(){var e=Object(c.a)(s.a.mark(function e(t){var n,r,o,c,l,u,p,d,m,f,h,v,b,g,y,E,C,k,O,S,P,x,w,T,A;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return a.map=t,a.map.addControl(new window.AMap.Scale),n=a.props.match.params,r=n.pointerAddressId,e.next=8,j({pointerAddressId:r});case 8:if(o=e.sent){e.next=11;break}return e.abrupt("return");case 11:return c=o.data,l=c.pointerAddress,u=c.estimateTask,p=[],d=[],m=[],e.next=19,a.getRemoteCompetitor({adcode:l.district,scope:"district",type:Z.Constant.type.TYPPE_COMPETITION_SHOP,lng:l.lng,lat:l.lat,distance:u?u.distance:1e3});case 19:if(f=e.sent,h=[l.lng,l.lat],v={id:l.id,options:{position:h,offset:new window.AMap.Pixel(-13,-30)}},b=null,l.fence&&(g=ge(l.fence)).length>=3&&(b=a.createPolygon(g,!1,"pointerAddressPolygon",l,Object(i.a)({},K))),y=1e3,u&&u.distance&&(y=u.distance),E={id:l.id,options:Object(i.a)({},q,{center:h,radius:y})},m.push(E),C=[],u&&u.hotFences&&u.hotFences.split("|").forEach(function(e){var t=ge(e);if(t.length>=3){var n=a.createPolygon(t,u.state===G.status.STATUS_WAIT_COMMIT,"userHotFencePolygons",{name:"\u70ed\u529b\u56f4\u680f",address:""},Object(i.a)({},z));C.push(n)}}),k=null,O=null,"conclusion"!==n.vtype){e.next=39;break}if(!u||u.execState!==G.execState.EXEC_STATUS_FINISH_CODE){e.next=39;break}return e.next=37,U({id:u.id});case 37:(S=e.sent)&&(O=S.data,(P=O.fence)&&(x=ge(P),k=a.createPolygon(x,!1,"appraiseFencePolygon",{name:"\u70b9\u5740\uff1a".concat(l.name,"<br/>\u5230\u8bbf\u56f4\u680f"),address:""},Object(i.a)({},B))));case 39:if(w=[],u&&u.competitorIds&&u.competitorIds.length&&f&&f.length&&u.competitorIds.split(",").forEach(function(e){f.forEach(function(t){if(e===t.id){var n=ge(t.fence);if(n.length>=3){var r=a.createPolygon(n,!1,"competitorPolygons",{name:t.name+"(\u7ade\u54c1\u5e97)",address:t.address},Object(i.a)({},X));w.push(r)}}})}),T=[],!u||!u.filterLabels){e.next=47;break}return e.next=45,a.getRemoteSharePointerAddress({adcode:l.district,scope:"district",lng:l.lng,lat:l.lat,distance:u?u.distance:1e4,labels:u.filterLabels});case 45:(A=e.sent)&&A.forEach(function(e){var t=ge(e.fence);if(t.length>=3){var n=a.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});T.push(n)}});case 47:a.setState({mapZoom:15,mapCenter:h,mapMarkers:p,mapCircles:m,mapPolygons:d,currentPointerAddress:l,pointerAddressMarker:v,pointerAddressPolygon:b,currentAppraise:u,userHotFencePolygons:C,competitors:f,competitorPolygons:w,appraiseFencePolygon:k,appraiseDataResult:O,sharePointerAddressPolyons:T});case 48:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.tranCompetitorKeyValue=function(e){if(!e||!e.length)return[];var t=[];return e.forEach(function(e){t.push({key:e.id,value:e.name})}),t},a.getFilterPointerAddress=Object(c.a)(s.a.mark(function e(){var t,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:{},t.filterLabels,t.competitorIds,t.distance;case 1:case"end":return e.stop()}},e)})),a.getRemoteCompetitor=Object(c.a)(s.a.mark(function e(){var t,a,n,r,o,i,c,l,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},a=t.distance,n=t.adcode,r=t.scope,o=t.lng,i=t.lat,c=t.type,e.next=3,Object(N.c)({pageSize:500,pageIndex:1,lng:o,lat:i,scope:r,adcode:n,type:c,distance:a});case 3:if(!(l=e.sent)){e.next=6;break}return e.abrupt("return",l.data.records);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)})),a.getRemoteSharePointerAddress=Object(c.a)(s.a.mark(function e(){var t,a,n,r,o,i,c,l,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},a=t.distance,n=t.adcode,r=t.scope,o=t.lng,i=t.lat,c=t.labels,e.next=3,Object(N.d)({distance:a,adcode:n,scope:r,lng:o,lat:i,labels:c});case 3:if(!(l=e.sent)){e.next=6;break}return e.abrupt("return",l.data);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)})),a.getCategroyLabels=Object(c.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),a.getObserveIds=Object(c.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),a.distanceChange=function(){var e=Object(c.a)(s.a.mark(function e(t,n){var r,o,c,l,u,p,d,m,f,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.filterLabels,o=a.state,c=o.mapCircles,l=o.currentPointerAddress,u=[],c&&c.length)for(p=0;p<c.length;p++)c[p].id===l.id?(d={id:l.id,options:Object(i.a)({},c[p].options,{radius:t})},u.push(d)):u.push(c[p]);return e.next=6,a.getRemoteCompetitor({adcode:l.district,scope:"district",type:Z.Constant.type.TYPPE_COMPETITION_SHOP,lng:l.lng,lat:l.lat,distance:t});case 6:if(m=e.sent,f=[],!r||!r.length){e.next=13;break}return e.next=11,a.getRemoteSharePointerAddress({adcode:l.district,scope:"district",lng:l.lng,lat:l.lat,distance:t,labels:r&&0!==r.length?r.join(","):null});case 11:(h=e.sent)&&h.forEach(function(e){var t=ge(e.fence);if(t.length>=3){var n=a.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});f.push(n)}});case 13:a.setState({mapCircles:u,competitors:m,sharePointerAddressPolyons:f});case 14:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.createCompetitorIds=function(e,t){var n=[];return e&&e.length&&t&&t.length&&e.forEach(function(e){for(var r=function(r){var o=t[r];if(o.id===e){if(!o.fence)return"continue";var s=ge(o.fence);if(s.length>=3){var c={id:e,options:Object(i.a)({},Y,{path:s,title:o.name}),events:{click:function(e){a.openCreateInfoWindiw(e.lnglat,o)}}};n.push(c)}}},o=0;o<t.length;o++)r(o)}),n},a.competitorIdsChange=function(e){var t=a.state,n=t.competitors,r=t.currentPointerAddress,o=[];e&&e.length&&n&&n.length&&e.forEach(function(e){for(var t=function(t){var r=n[t];if(r.id===e){if(!r.fence)return"continue";var s=ge(r.fence);if(s.length>=3){var c={id:e,options:Object(i.a)({},Y,{path:s,title:r.name}),events:{click:function(e){a.openCreateInfoWindiw(e.lnglat,r)}}};o.push(c)}}},r=0;r<n.length;r++)t(r)});var s=ge(r.fence);if(s.length>=3){var c={id:r.id,options:Object(i.a)({},Y,{path:s})};o.push(c)}console.log(o),a.setState({mapPolygons:o})},a.openCreateInfoWindiw=function(e,t){var n=[];n.push('<div style="padding:0px 0px 0px 4px;"><b>\u540d\u79f0:'.concat(t.name,"</b>")),t.address&&n.push("\u5730\u5740 :".concat(t.address,"</div></div>")),a.setState({mapWindowInfo:{options:{content:n.join("<br/>"),opened:!0,position:e,closeWhenClickMap:!0},events:{open:function(){},close:function(){a.setState({mapWindowInfo:null})}}}})},a.onCreateUserFenceHandle=function(){a.setState({mapNeedClear:!0,mapDrawMode:{mode:"polygon",options:{},events:[function(e){var t=ge(e.obj.getPath().join(";")),n=a.createPolygon(t,!0,"userHotFencePolygons",{name:"\u70ed\u529b\u56f4\u680f",address:""});e.obj.getMap().remove(e.obj);var r=[].concat(a.state.userHotFencePolygons,n);a.setState({userHotFencePolygons:r})}]}})},a.createPolygon=function(e,t,n,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=function(){var e=(new Date).getTime();return window.performance&&"function"===typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:3&a|8).toString(16)})}();return{id:c,options:Object(i.a)({},Y,s,{id:c,path:e,editable:t?{events:{adjust:function(e){var t=e.target.getPath(),s=a.createPolygon(ge(t.join(";")),!0,n,o);s.id=c;var l=(a.state[n]||[]).reduce(function(e,t){return t.id===c?e.push(s):e.push(Object(i.a)({},t,{options:Object(i.a)({},t.options)})),e},[]);a.setState(Object(r.a)({},n,l))}}}:null}),events:{click:function(e){o&&a.openCreateInfoWindiw(e.lnglat,o)}}}},a.onRemoveUserHotFence=function(e){var t=a.state.userHotFencePolygons,n=[];(void 0===t?[]:t).forEach(function(t){t.id!==e.id&&n.push(t)}),a.setState({userHotFencePolygons:n})},a.saveOrUpdate=function(){var e=Object(c.a)(s.a.mark(function e(t,r){var o,c,l,u,p,d,m,f,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.state,c=o.userHotFencePolygons,l=o.currentPointerAddress,u=o.currentAppraise,p=void 0===u?{}:u,d=t,d=Object(i.a)({},p,d,{filterLabels:d.filterLabels?d.filterLabels.join(","):"",competitorIds:d.competitorIds?d.competitorIds.join(","):"",showPersonCount:d.showPersonCount?1:0,arriveScale:d.arriveScale?10*d.arriveScale:1}),!c||!c.length||d.fencesHotDate&&d.fenaceHotCondition){e.next=6;break}return n.a.error({title:"\u70ed\u529b\u5206\u6790\u65e5\u671f\u3001\u70ed\u529b\u6761\u4ef6\u5fc5\u987b\u586b\u5199"}),e.abrupt("return");case 6:return c&&c.length&&(m=[],c.forEach(function(e){var t=e.options.path;m.push(t.join(";"))}),d.hotFences=m.join("|")),c&&c.length&&d.fencesHotDate?(f=d.fencesHotDate[0],h=d.fencesHotDate[1],d.fencesHotDate=E()(f).format("YYYY-MM-DD")+";"+E()(h).format("YYYY-MM-DD")):d.fencesHotDate="",d.pointerAddressId=l.id,console.log(d),e.next=12,D(d,r);case 12:e.sent&&w.a.push("/listPointAddress");case 14:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.onSave=function(){a.saveOrUpdate("save")},a.onSubmit=function(){a.saveOrUpdate("submit")},a.goBackList=function(){w.a.push("/listPointAddress")},a.onSaveConclusion=function(){var e=Object(c.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.currentAppraise,e.next=3,H(n.id,t);case 3:e.sent.data&&w.a.push("/listPointAddress");case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onLabelsChange=function(){var e=Object(c.a)(s.a.mark(function e(t,n){var r,o,i,c,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.distance,t&&0!==t.length){e.next=4;break}return a.setState({sharePointerAddressPolyons:[]}),e.abrupt("return");case 4:return o=a.state.currentPointerAddress,i={adcode:o.district,scope:"district",lng:o.lng,lat:o.lat,distance:r||1e3,labels:t.join(",")},e.next=8,a.getRemoteSharePointerAddress(i);case 8:(c=e.sent)&&(l=[],c.forEach(function(e){var t=ge(e.fence);if(t.length>=3){var n=a.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});l.push(n)}}),a.setState({sharePointerAddressPolyons:l}));case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.createMarker=function(){},a.state={mapCenter:null,mapCircles:[],mapMarkers:[],mapPolygons:[],mapZoom:4,mapNeedClear:!1,mapDrawMode:!1,mapWindowInfo:null,currentPointerAddress:{},competitors:[],userHotFencePolygons:[],pointerAddressPolygon:null,pointerAddressMarker:null,competitorPolygons:[],filterLabelPolygons:[],appraiseFencePolygon:null,sharePointerAddressPolyons:[],appraiseDataResult:{}},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.mapCenter,a=e.mapNeedClear,n=e.mapZoom,r=void 0===n?4:n,o=e.mapCircles,s=e.mapMarkers,i=e.mapPolygons,c=e.currentAppraise,l=e.currentPointerAddress,u=e.mapDrawMode,p=e.competitors,d=e.mapWindowInfo,m=e.userHotFencePolygons,f=e.pointerAddressMarker,v=e.pointerAddressPolygon,y=e.competitorPolygons,O=e.appraiseFencePolygon,S=e.appraiseDataResult,P=e.sharePointerAddressPolyons,w=this.props.match.params.vtype,A=[];if(c&&c.fencesHotDate){var I=c.fencesHotDate.split(";");A.push(E()(I[0])),A.push(E()(I[1]))}return b.a.createElement(h.a,{style:{width:"100%",height:"100%"}},b.a.createElement(ve,null,b.a.createElement(T.a,{refer:this.setMapInstance,style:{width:"100%",height:"100%"},options:{center:t,drawMode:u,zoom:r,clear:a}},o&&o.length&&o.map(function(e){return b.a.createElement(k.a,{key:e.id,options:e.options,events:e.events})}),s&&s.length&&s.map(function(e){return b.a.createElement(g.a,{key:e.id,options:e.options,events:e.events})}),f&&b.a.createElement(g.a,{key:f.id,options:f.options,events:f.events}),v&&b.a.createElement(C.a,{key:v.id,options:v.options,events:v.events}),O&&b.a.createElement(C.a,{key:O.id,options:O.options,events:O.events}),i&&i.length&&i.map(function(e){return b.a.createElement(C.a,{key:e.id,options:e.options,events:e.events})}),m&&m.length&&m.map(function(e){return b.a.createElement(C.a,{key:e.id,options:e.options,events:e.events})}),P&&P.length&&P.map(function(e){return b.a.createElement(C.a,{key:e.id,options:e.options,events:e.events})}),y&&y.length&&y.map(function(e){return b.a.createElement(C.a,{key:e.id,options:e.options,events:e.events})}),d&&b.a.createElement(x,{key:d.id,options:d.options,events:d.events}))),b.a.createElement(be,{theme:"light",width:"25%",style:{height:"100%",overflow:"auto"}},"appraise"===w&&b.a.createElement(de,{pointerAddress:l,appraise:c,onCompetitorIdsChange:this.competitorIdsChange,onDistanceChange:this.distanceChange,saveOrUpdate:this.saveOrUpdate,competitors:p,userHotFencePolygons:m,goBackList:this.goBackList,onCreateUserFenceHandle:this.onCreateUserFenceHandle,onLabelsChange:this.onLabelsChange}),"conclusion"===w&&b.a.createElement(he,{pointerAddress:l,appraiseDataResult:S,goBackList:this.goBackList,onSave:this.onSaveConclusion})))}}]),t}(b.a.Component))||V;t.default=ye}}]);