(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{658:function(e,t,n){"use strict";n.r(t);n(634);var a=n(638),r=n(237),o=n(18),s=n.n(o),i=n(17),c=n(33),l=n(41),u=n(42),p=n(44),d=n(43),m=n(45),f=(n(628),n(629)),h=(n(232),n(115)),v=(n(649),n(647)),g=(n(631),n(632)),b=n(1),y=n.n(b),E=n(641),C=n(15),O=n.n(C),k=n(642),P=n(643),x=n(27),S="InfoWindow",w=console.log,T=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(p.a)(this,Object(d.a)(t).call(this))).refElement=null,e._entity=null,w(S,"constructor",e._entity),e}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){w(S,"componentDidMount",this._entity);var e=this.props,t=e.__map__,n=e.options,a=e.events,r=(e.children,Object(i.a)({},n||{},{map:t}));this._entity=Object(x.b)(r,a),this._entity&&this.props.refer&&this.props.refer(this._entity)}},{key:"componentDidUpdate",value:function(e){w(S,"componentDidUpdate",this._entity);var t=this.props,n=t.__map__,a=t.options,r=t.events,o=(t.children,Object(i.a)({},a||{},{map:n}));if(!this._entity)return this._entity=Object(x.b)(o,r),void(this._entity&&this.props.refer&&this.props.refer(this._entity));var s=Object(i.a)({},e.options||{},{map:e.__map__});Object(x.n)(this._entity,o,r,s,e.events)}},{key:"componentWillUnmount",value:function(){w(S,"componentWillUnmount",this._entity),this._entity&&(this._entity.setMap(null),this._entity=null,this.props.refer&&this.props.refer(this._entity))}},{key:"render",value:function(){return w(S,"render",this._entity),null}}]),t}(b.Component),A=n(134),I=n(644),_=n(40),j=n(104).a.HOST;function D(e){return M.apply(this,arguments)}function M(){return(M=Object(c.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(_.a)("".concat(j,"/api/estimateTask/querybyPointerAddressId?paId=").concat(t.pointerAddressId),{method:"GET"}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function U(e,t){return F.apply(this,arguments)}function F(){return(F=Object(c.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("save"!==n){e.next=4;break}return e.abrupt("return",Object(_.a)("".concat(j,"/api/estimateTask/create"),{method:"POST",body:t}));case 4:return e.abrupt("return",Object(_.a)("".concat(j,"/api/estimateTask/submit"),{method:"POST",body:t}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e){return L.apply(this,arguments)}function L(){return(L=Object(c.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(_.a)("".concat(j,"/api/estimateTask/getDataResult?emtimateId=").concat(t.id),{method:"GET"}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function R(e,t){return W.apply(this,arguments)}function W(){return(W=Object(c.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(_.a)("".concat(j,"/api/estimateTask/saveConclusion?emtimateId=").concat(t),{method:"PUT",body:n}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var V,N,B,Y=n(234),z={strokeWeight:2,strokeOpacity:.4,fillColor:"#ee2200",fillOpacity:.1,strokeStyle:"solid"},K={strokeColor:"#F33",strokeOpacity:.4,strokeWeight:2,fillColor:"#ee2200",fillOpacity:.08,bubble:!0},X=n(325),q={status:{STATUS_WAIT_COMMIT:0,STATUS_COMMITED:1},execState:{EXEC_STATUS_NULL:0,EXEC_STATUS_CALCULATED_FENCE:1,EXEC_STATUS_REQUESTED_FENCE_DATA:2,EXEC_STATUS_REQUESTED_FENCE_HOT_DATA:4,EXEC_STATUS_FINISH_CODE:7},dateReaultState:{RESULT_DATE_STATUS_WAIT_SUBMIT:"waitSubmit",RESULT_DATE_STATUS_SUBMITED:"submited"}},Z=(n(640),n(637)),G=(n(326),n(630)),J=(n(327),n(156)),Q=(n(646),n(12)),$=(n(328),n(109)),ee=(n(329),n(63)),te=(n(170),n(52)),ne=(n(651),n(653)),ae=(n(652),n(654)),re=(n(645),n(648)),oe=n(635),se=(f.a.Item,h.a.Option),ie=v.a.RangePicker,ce=f.a.create()(V=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={treeData:[]},n.saveOrUpdate=function(){var e=Object(c.a)(s.a.mark(function e(t){var a,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=n.props,r=a.form.validateFields,o=a.saveOrUpdate,r(function(){var e=Object(c.a)(s.a.mark(function e(n,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return");case 2:o&&o(a,t);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.onSave=function(){n.saveOrUpdate("save")},n.onSubmit=function(){n.saveOrUpdate("submit")},n.onLabelsChange=function(e){var t=n.props.onLabelsChange;if(t){var a=n.props.form.getFieldsValue();a.filterLabels=e,t(e,a)}},n.onDistanceChange=function(e){var t=n.props.onDistanceChange;if(t){var a=n.props.form.getFieldsValue();a.distance=e,t(e,a)}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(Object(c.a)(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(oe.c)();case 2:n=t.sent,e.setState({treeData:n});case 4:case"end":return t.stop()}},t)})),100)}},{key:"render",value:function(){var e=this,t=this.props,n=t.form.getFieldDecorator,a=t.pointerAddress,r=t.appraise,o=t.onCompetitorIdsChange,s=t.competitors,i=t.userHotFencePolygons,c=t.goBackList,l=t.onCreateUserFenceHandle,u=[];if(r&&r.fencesHotDate){var p=r.fencesHotDate.split(";");u.push(O()(p[0])),u.push(O()(p[1]))}return y.a.createElement("div",{className:"pointerCreate"},y.a.createElement(Z.a,{title:"\u8bc4\u4f30\u70b9\uff1a".concat(a.name),bordered:!1},y.a.createElement(f.a,null,y.a.createElement(f.a.Item,{label:"\u4e1a\u6001\u6807\u7b7e"},n("filterLabels",{initialValue:r&&r.filterLabels?r.filterLabels.split(","):[]})(y.a.createElement(re.a,{dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"\u8bf7\u9009\u62e9",allowClear:!0,multiple:!0,onChange:this.onLabelsChange,treeData:this.state.treeData}))),y.a.createElement(f.a.Item,{label:"\u7ade\u5bf9\u5448\u73b0"},n("competitorIds",{initialValue:r&&r.competitorIds?r.competitorIds.split(","):[]})(y.a.createElement(h.a,{mode:"multiple",placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},onChange:o},s.map(function(e){return e.id!==a.id?y.a.createElement(se,{key:e.id,value:e.id},e.name):null})))),y.a.createElement(f.a.Item,{label:"\u5230\u8bbf\u767e\u5206\u6bd4"},n("arriveScale",{initialValue:r&&r.arriveScale?parseInt(r.arriveScale):20})(y.a.createElement(ae.a,{step:1,max:100,min:20}))),y.a.createElement(f.a.Item,{label:"\u8f90\u5c04\u8ddd\u79bb"},n("distance",{initialValue:r&&r.distance?parseInt(r.distance):1e3})(y.a.createElement(ae.a,{marks:{1000:"1KM",1500:"1.5KM",2000:"2KM",2500:"2.5KM",3000:"3KM"},step:500,max:3e3,min:1e3,onChange:this.onDistanceChange}))),y.a.createElement(f.a.Item,{label:"\u5b58\u91cf\u4eba\u53e3"},n("showPersonCount",{initialValue:!(!r||null==r.showPersonCount||"undefined"==typeof r.showPersonCount)&&0!==r.showPersonCount,valuePropName:"checked"})(y.a.createElement(ne.a,{size:"small",checkedChildren:"\u663e\u793a",unCheckedChildren:"\u4e0d\u663e\u793a"}))),y.a.createElement(f.a.Item,{label:"\u70ed\u529b\u5206\u6790"},y.a.createElement(Z.a,{id:"hotCard"},y.a.createElement($.a,null,y.a.createElement(ee.a,null,(!r||r&&r.state===q.status.STATUS_WAIT_COMMIT)&&y.a.createElement(te.a,{type:"primary",size:"small",onClick:l},"\u65b0\u5efa\u56f4\u680f"))),y.a.createElement($.a,null,y.a.createElement(ee.a,null,i&&i.map(function(t){return y.a.createElement(G.a,{readOnly:!0,key:t.id,value:t.options.path.join(";"),suffix:(!r||r&&r.state===q.status.STATUS_WAIT_COMMIT)&&y.a.createElement(J.a,{title:"\u5220\u9664\u56f4\u680f"},y.a.createElement(Q.a,{type:"delete",style:{color:"rgba(0,0,0,.45)"},onClick:function(){e.onRemoveUserHotFence(t)}}))})}))),y.a.createElement($.a,{gutter:10},y.a.createElement(ee.a,{span:8},"\u9009\u62e9\u65e5\u671f:"),y.a.createElement(ee.a,{span:16},n("fencesHotDate",{initialValue:u})(y.a.createElement(ie,null)))),y.a.createElement($.a,{gutter:10},y.a.createElement(ee.a,null,"\u56f4\u680f\u70ed\u529b\u6761\u4ef6"),y.a.createElement(ee.a,null,n("fenaceHotCondition",{initialValue:r&&r.fenaceHotCondition?r.fenaceHotCondition:""})(y.a.createElement(h.a,null,y.a.createElement(se,{value:"1"},"\u4eba\u53e3"))))))),y.a.createElement(f.a.Item,{label:"\u6d4b\u63a7\u70b9"},n("observeId",{initialValue:r&&r.observeId?r.observeId:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(y.a.createElement(h.a,null,y.a.createElement(se,{value:"1221212"},"\u6d4b\u63a7\u70b91"))))),y.a.createElement("div",{id:"btnbar",style:{marginTop:"20px"}},(!r||r&&r.state===q.status.STATUS_WAIT_COMMIT)&&y.a.createElement(te.a,{size:"small",type:"primary",onClick:this.onSave},"\u4fdd\u5b58"),(!r||r&&r.state===q.status.STATUS_WAIT_COMMIT)&&y.a.createElement(te.a,{size:"small",type:"primary",onClick:this.onSubmit},"\u4fdd\u5b58\u5e76\u63d0\u4ea4"),y.a.createElement(te.a,{size:"small",type:"primary",onClick:c},"\u8fd4\u56de\u5217\u8868"))))}}]),t}(y.a.Component))||V,le=(n(639),n(636)),ue=h.a.Option,pe=f.a.create()(N=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onSave=function(){var e=n.props,t=e.form.validateFields,a=e.onSave;t(function(){var e=Object(c.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:a&&a(n);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,n=e.pointerAddress,a=e.appraiseDataResult,r=e.goBackList;return y.a.createElement("div",{id:"conclusion"},y.a.createElement(Z.a,{title:"\u70b9\u5740\u540d\u79f0:".concat(n.name),bordered:!1},y.a.createElement($.a,null,y.a.createElement(ee.a,null,y.a.createElement(f.a,{layout:"horizontal"},y.a.createElement(f.a.Item,{label:"\u5230\u8bbf\u56f4\u680f\u4eba\u53e3\u6570\u91cf"},y.a.createElement(le.a,{bordered:!0,size:"small",columns:[{title:"\u7c7b\u578b",dataIndex:"type"},{title:"\u6570\u91cf"}]})),y.a.createElement(f.a.Item,null,y.a.createElement("div",null,"\u6d4b\u63a7\u5ba2\u6d41\u91cf:",a&&a.observerRateFlow?a.observerRateFlow:"0")),y.a.createElement(f.a.Item,{label:"\u70b9\u5740\u7ed3\u8bba"},t("conclusion",{initialValue:a&&a.conclusion?a.conclusion:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(y.a.createElement(h.a,{placeholder:"\u8bf7\u9009\u62e9"},y.a.createElement(ue,{value:"1"},"\u653b\u575a"),y.a.createElement(ue,{value:"2"},"\u72ec\u5360"),y.a.createElement(ue,{value:"3"},"\u4e3b\u52a8\u5206\u6d41"),y.a.createElement(ue,{value:"4"},"\u88ab\u52a8\u5206\u6d41")))),y.a.createElement(f.a.Item,{label:"\u51c6\u5165\u65f6\u95f4"},t("enterDate",{initialValue:a&&a.enterDate?a.enterDate:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(y.a.createElement(h.a,null,y.a.createElement(ue,{value:"2019"},"2019\u5e74"),y.a.createElement(ue,{value:"2020"},"2020\u5e74"),y.a.createElement(ue,{value:"2021"},"2021\u5e74"),y.a.createElement(ue,{value:"2022"},"2022\u5e74"),y.a.createElement(ue,{value:"2023"},"2023\u5e74"),y.a.createElement(ue,{value:"2024"},"2024\u5e74"),y.a.createElement(ue,{value:"2025"},"2025\u5e74"),y.a.createElement(ue,{value:"2026"},"2026\u5e74")))),y.a.createElement(f.a.Item,{label:"\u5546\u5708\u7c7b\u578b"},t("businessType",{initialValue:a&&a.businessType?a.businessType:"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(y.a.createElement(h.a,null,y.a.createElement(ue,{value:"1"},"\u7c7b\u578b\u4e00"),y.a.createElement(ue,{value:"2"},"\u7c7b\u578b\u4e8c")))),y.a.createElement(f.a.Item,null,y.a.createElement("div",null,"\u8f90\u5c04\u8ddd\u79bb:",a&&a.radiationDistance?a.radiationDistance:"0")),y.a.createElement(f.a.Item,null,y.a.createElement("label",null,"\u8f90\u5c04\u9762\u79ef:",a&&a.radiationArea?a.radiationArea:"0")))))),y.a.createElement("div",{id:"btnbar",style:{textAlign:"end"}},(!a||a.state!==q.dateReaultState.RESULT_DATE_STATUS_SUBMITED)&&y.a.createElement(te.a,{type:"primary",onClick:this.onSave},"\u4fdd\u5b58"),y.a.createElement(te.a,{type:"primary",onClick:r},"\u8fd4\u56de\u5217\u8868")))}}]),t}(y.a.Component))||N;var de=g.a.Content,me=g.a.Sider;v.a.RangePicker,h.a.Option;function fe(e){if(!e)return[];var t=e.split(";");if(t.length>=3){var n=[];return t.forEach(function(e){n.push(e.split(","))}),n}return[]}var he=f.a.create()(B=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).setMapInstance=function(){var e=Object(c.a)(s.a.mark(function e(t){var a,r,o,c,l,u,p,d,m,f,h,v,g,b,y,E,C,O,k,P,x,S,w,T,A;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n.map=t,n.map.addControl(new window.AMap.Scale),a=n.props.match.params,r=a.pointerAddressId,e.next=8,D({pointerAddressId:r});case 8:if(o=e.sent){e.next=11;break}return e.abrupt("return");case 11:return c=o.data,l=c.pointerAddress,u=c.estimateTask,p=[],d=[],m=[],console.log(u),e.next=20,n.getRemoteCompetitor({adcode:l.district,scope:"district",type:X.Constant.type.TYPPE_COMPETITION_SHOP,lng:l.lng,lat:l.lat,distance:u?u.distance:1e3});case 20:if(f=e.sent,h=[l.lng,l.lat],v={id:l.id,options:{position:h,offset:new window.AMap.Pixel(-13,-30)}},g=null,l.fence&&(b=fe(l.fence)).length>=3&&(g=n.createPolygon(b,!1,"pointerAddressPolygon",l)),y=1e3,u&&u.distance&&(y=u.distance),E={id:l.id,options:Object(i.a)({},K,{center:h,radius:y})},m.push(E),C=[],u&&u.hotFences&&u.hotFences.split("|").forEach(function(e){var t=fe(e);if(t.length>=3){var a=n.createPolygon(t,u.state===q.status.STATUS_WAIT_COMMIT,"userHotFencePolygons",{name:"\u70ed\u529b\u56f4\u680f",address:""});C.push(a)}}),O=null,k=null,!u||u.execState!==q.execState.EXEC_STATUS_FINISH_CODE){e.next=38;break}return e.next=36,H({id:u.id});case 36:(P=e.sent)&&(k=P.data,(x=k.fence)&&(console.log(x),S=fe(x),O=n.createPolygon(S,!1,"appraiseFencePolygon",{name:"\u70b9\u5740\uff1a".concat(l.name,"<br/>\u5230\u8bbf\u56f4\u680f"),address:""})));case 38:if(w=[],u&&u.competitorIds&&u.competitorIds.length&&f&&f.length&&u.competitorIds.split(",").forEach(function(e){f.forEach(function(t){if(e===t.id){var a=fe(t.fence);if(a.length>=3){var r=n.createPolygon(a,!1,"competitorPolygons",{name:t.name+"(\u7ade\u54c1\u5e97)",address:t.address});w.push(r)}}})}),T=[],!u||!u.filterLabels){e.next=46;break}return e.next=44,n.getRemoteSharePointerAddress({adcode:l.district,scope:"district",lng:l.lng,lat:l.lat,distance:u?u.distance:1e4,labels:u.filterLabels});case 44:(A=e.sent)&&A.forEach(function(e){var t=fe(e.fence);if(t.length>=3){var a=n.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});T.push(a)}});case 46:n.setState({mapZoom:15,mapCenter:h,mapMarkers:p,mapCircles:m,mapPolygons:d,currentPointerAddress:l,pointerAddressMarker:v,pointerAddressPolygon:g,currentAppraise:u,userHotFencePolygons:C,competitors:f,competitorPolygons:w,appraiseFencePolygon:O,appraiseDataResult:k,sharePointerAddressPolyons:T});case 47:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.tranCompetitorKeyValue=function(e){if(!e||!e.length)return[];var t=[];return e.forEach(function(e){t.push({key:e.id,value:e.name})}),t},n.getFilterPointerAddress=Object(c.a)(s.a.mark(function e(){var t,n=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:{},t.filterLabels,t.competitorIds,t.distance;case 1:case"end":return e.stop()}},e)})),n.getRemoteCompetitor=Object(c.a)(s.a.mark(function e(){var t,n,a,r,o,i,c,l,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.distance,a=t.adcode,r=t.scope,o=t.lng,i=t.lat,c=t.type,e.next=3,Object(Y.c)({pageSize:500,pageIndex:1,lng:o,lat:i,scope:r,adcode:a,type:c,distance:n});case 3:if(!(l=e.sent)){e.next=6;break}return e.abrupt("return",l.data.records);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)})),n.getRemoteSharePointerAddress=Object(c.a)(s.a.mark(function e(){var t,n,a,r,o,i,c,l,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.distance,a=t.adcode,r=t.scope,o=t.lng,i=t.lat,c=t.labels,e.next=3,Object(Y.d)({distance:n,adcode:a,scope:r,lng:o,lat:i,labels:c});case 3:if(!(l=e.sent)){e.next=6;break}return e.abrupt("return",l.data);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)})),n.getCategroyLabels=Object(c.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),n.getObserveIds=Object(c.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),n.distanceChange=function(){var e=Object(c.a)(s.a.mark(function e(t,a){var r,o,c,l,u,p,d,m,f,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.filterLabels,o=n.state,c=o.mapCircles,l=o.currentPointerAddress,u=[],c&&c.length)for(p=0;p<c.length;p++)c[p].id===l.id?(d={id:l.id,options:Object(i.a)({},c[p].options,{radius:t})},u.push(d)):u.push(c[p]);return e.next=6,n.getRemoteCompetitor({adcode:l.district,scope:"district",type:X.Constant.type.TYPPE_COMPETITION_SHOP,lng:l.lng,lat:l.lat,distance:t});case 6:if(m=e.sent,f=[],!r||!r.length){e.next=13;break}return e.next=11,n.getRemoteSharePointerAddress({adcode:l.district,scope:"district",lng:l.lng,lat:l.lat,distance:t,labels:r&&0!==r.length?r.join(","):null});case 11:(h=e.sent)&&h.forEach(function(e){var t=fe(e.fence);if(t.length>=3){var a=n.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});f.push(a)}});case 13:n.setState({mapCircles:u,competitors:m,sharePointerAddressPolyons:f});case 14:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.createCompetitorIds=function(e,t){var a=[];return e&&e.length&&t&&t.length&&e.forEach(function(e){for(var r=function(r){var o=t[r];if(o.id===e){if(!o.fence)return"continue";var s=fe(o.fence);if(s.length>=3){var c={id:e,options:Object(i.a)({},z,{path:s,title:o.name}),events:{click:function(e){n.openCreateInfoWindiw(e.lnglat,o)}}};a.push(c)}}},o=0;o<t.length;o++)r(o)}),a},n.competitorIdsChange=function(e){var t=n.state,a=t.competitors,r=t.currentPointerAddress,o=[];e&&e.length&&a&&a.length&&e.forEach(function(e){for(var t=function(t){var r=a[t];if(r.id===e){if(!r.fence)return"continue";var s=fe(r.fence);if(s.length>=3){var c={id:e,options:Object(i.a)({},z,{path:s,title:r.name}),events:{click:function(e){n.openCreateInfoWindiw(e.lnglat,r)}}};o.push(c)}}},r=0;r<a.length;r++)t(r)});var s=fe(r.fence);if(s.length>=3){var c={id:r.id,options:Object(i.a)({},z,{path:s})};o.push(c)}console.log(o),n.setState({mapPolygons:o})},n.openCreateInfoWindiw=function(e,t){var a=[];a.push('<div style="padding:0px 0px 0px 4px;"><b>\u540d\u79f0:'.concat(t.name,"</b>")),t.address&&a.push("\u5730\u5740 :".concat(t.address,"</div></div>")),n.setState({mapWindowInfo:{options:{content:a.join("<br/>"),opened:!0,position:e,closeWhenClickMap:!0},events:{open:function(){},close:function(){n.setState({mapWindowInfo:null})}}}})},n.onCreateUserFenceHandle=function(){n.setState({mapNeedClear:!0,mapDrawMode:{mode:"polygon",options:{},events:[function(e){var t=fe(e.obj.getPath().join(";")),a=n.createPolygon(t,!0,"userHotFencePolygons",{name:"\u70ed\u529b\u56f4\u680f",address:""});e.obj.getMap().remove(e.obj);var r=[].concat(n.state.userHotFencePolygons,a);n.setState({userHotFencePolygons:r})}]}})},n.createPolygon=function(e,t,a,o){var s=function(){var e=(new Date).getTime();return window.performance&&"function"===typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return{id:s,options:Object(i.a)({},z,{id:s,path:e,editable:t?{events:{adjust:function(e){var t=e.target.getPath(),c=n.createPolygon(fe(t.join(";")),!0,a,o);c.id=s;var l=(n.state[a]||[]).reduce(function(e,t){return t.id===s?e.push(c):e.push(Object(i.a)({},t,{options:Object(i.a)({},t.options)})),e},[]);n.setState(Object(r.a)({},a,l))}}}:null}),events:{click:function(e){o&&n.openCreateInfoWindiw(e.lnglat,o)}}}},n.onRemoveUserHotFence=function(e){var t=n.state.userHotFencePolygons,a=[];(void 0===t?[]:t).forEach(function(t){t.id!==e.id&&a.push(t)}),n.setState({userHotFencePolygons:a})},n.saveOrUpdate=function(){var e=Object(c.a)(s.a.mark(function e(t,r){var o,c,l,u,p,d,m,f,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.state,c=o.userHotFencePolygons,l=o.currentPointerAddress,u=o.currentAppraise,p=void 0===u?{}:u,d=t,d=Object(i.a)({},p,d,{filterLabels:d.filterLabels?d.filterLabels.join(","):"",competitorIds:d.competitorIds?d.competitorIds.join(","):"",showPersonCount:d.showPersonCount?1:0}),!c||!c.length||d.fencesHotDate&&d.fenaceHotCondition){e.next=6;break}return a.a.error({title:"\u70ed\u529b\u5206\u6790\u65e5\u671f\u3001\u70ed\u529b\u6761\u4ef6\u5fc5\u987b\u586b\u5199"}),e.abrupt("return");case 6:return c&&c.length&&(m=[],c.forEach(function(e){var t=e.options.path;m.push(t.join(";"))}),d.hotFences=m.join("|")),c&&c.length&&d.fencesHotDate?(f=d.fencesHotDate[0],h=d.fencesHotDate[1],d.fencesHotDate=O()(f).format("YYYY-MM-DD")+";"+O()(h).format("YYYY-MM-DD")):d.fencesHotDate="",d.pointerAddressId=l.id,console.log(d),e.next=12,U(d,r);case 12:e.sent&&A.a.push("/listPointAddress");case 14:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.onSave=function(){n.saveOrUpdate("save")},n.onSubmit=function(){n.saveOrUpdate("submit")},n.goBackList=function(){A.a.push("/listPointAddress")},n.onSaveConclusion=function(){var e=Object(c.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.currentAppraise,e.next=3,R(a.id,t);case 3:e.sent.data&&A.a.push("/listPointAddress");case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.onLabelsChange=function(){var e=Object(c.a)(s.a.mark(function e(t,a){var r,o,i,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.distance,t&&0!==t.length){e.next=4;break}return n.setState({sharePointerAddressPolyons:[]}),e.abrupt("return");case 4:return o=n.state.currentPointerAddress,e.next=7,n.getRemoteSharePointerAddress({adcode:o.district,scope:"district",lng:o.lng,lat:o.lat,distance:1e3|r,labels:t.join(",")});case 7:(i=e.sent)&&(c=[],i.forEach(function(e){var t=fe(e.fence);if(t.length>=3){var a=n.createPolygon(t,!1,"sharePointerAddressPolyons",{name:e.name});c.push(a)}}),n.setState({sharePointerAddressPolyons:c}));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.createMarker=function(){},n.state={mapCenter:null,mapCircles:[],mapMarkers:[],mapPolygons:[],mapZoom:4,mapNeedClear:!1,mapDrawMode:!1,mapWindowInfo:null,currentPointerAddress:{},competitors:[],userHotFencePolygons:[],pointerAddressPolygon:null,pointerAddressMarker:null,competitorPolygons:[],filterLabelPolygons:[],appraiseFencePolygon:null,sharePointerAddressPolyons:[],appraiseDataResult:{}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.mapCenter,n=e.mapNeedClear,a=e.mapZoom,r=void 0===a?4:a,o=e.mapCircles,s=e.mapMarkers,i=e.mapPolygons,c=e.currentAppraise,l=e.currentPointerAddress,u=e.mapDrawMode,p=e.competitors,d=e.mapWindowInfo,m=e.userHotFencePolygons,f=e.pointerAddressMarker,h=e.pointerAddressPolygon,v=e.competitorPolygons,b=e.appraiseFencePolygon,C=e.appraiseDataResult,x=e.sharePointerAddressPolyons,S=this.props.match.params.vtype,w=[];if(c&&c.fencesHotDate){var A=c.fencesHotDate.split(";");w.push(O()(A[0])),w.push(O()(A[1]))}return y.a.createElement(g.a,{style:{width:"100%",height:"100%"}},y.a.createElement(de,null,y.a.createElement(I.a,{refer:this.setMapInstance,style:{width:"100%",height:"100%"},options:{center:t,drawMode:u,zoom:r,clear:n}},o&&o.length&&o.map(function(e){return y.a.createElement(P.a,{key:e.id,options:e.options,events:e.events})}),s&&s.length&&s.map(function(e){return y.a.createElement(E.a,{key:e.id,options:e.options,events:e.events})}),f&&y.a.createElement(E.a,{key:f.id,options:f.options,events:f.events}),h&&y.a.createElement(k.a,{key:h.id,options:h.options,events:h.events}),b&&y.a.createElement(k.a,{key:b.id,options:b.options,events:b.events}),i&&i.length&&i.map(function(e){return y.a.createElement(k.a,{key:e.id,options:e.options,events:e.events})}),m&&m.length&&m.map(function(e){return y.a.createElement(k.a,{key:e.id,options:e.options,events:e.events})}),x&&x.length&&x.map(function(e){return y.a.createElement(k.a,{key:e.id,options:e.options,events:e.events})}),v&&v.length&&v.map(function(e){return y.a.createElement(k.a,{key:e.id,options:e.options,events:e.events})}),d&&y.a.createElement(T,{key:d.id,options:d.options,events:d.events}))),y.a.createElement(me,{theme:"light",width:"25%",style:{height:"100%",overflow:"auto"}},"appraise"===S&&y.a.createElement(ce,{pointerAddress:l,appraise:c,onCompetitorIdsChange:this.competitorIdsChange,onDistanceChange:this.distanceChange,saveOrUpdate:this.saveOrUpdate,competitors:p,userHotFencePolygons:m,goBackList:this.goBackList,onCreateUserFenceHandle:this.onCreateUserFenceHandle,onLabelsChange:this.onLabelsChange}),"conclusion"===S&&y.a.createElement(pe,{pointerAddress:l,appraiseDataResult:C,goBackList:this.goBackList,onSave:this.onSaveConclusion})))}}]),t}(y.a.Component))||B;t.default=he}}]);